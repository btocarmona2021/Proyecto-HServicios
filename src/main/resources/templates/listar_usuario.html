<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head th:replace= "/frangments/head :: head"</head>

    <body class="grid-container">
        <header class="header">
            <nav th:replace="/frangments/navbar :: nav"</nav>
        </header>
        <article class="main">
    <div>Listamos los usuarios</div>
    <h1> Datos de los usuarios </h1>
    <div class="container m-5">
       
        <table border="1" >

            <thead>
            
            <tr>
                <th scope="col">Nombre</th>
                <th scope="col">Apellido</th>
                <th scope="col">Dirección</th>
                <th scope="col">Telefono</th>
                <th scope="col">Correo</th>
                <th scope="col">Estado</th>
                <th scope="col">Rol</th>
                <th scope="col" colspan="2">Accciones</th>
                <!--  verificar esta linea hasrole       <th scope="col" sec:authorize="hasRole('ADMIN')" colspan="2">Acciones</th>-->
            </tr>
            </thead>
            <tbody th:each="usuarios : ${usuarios}">
            <tr>
                <th scope="row" th:text="${usuarios.id}" hidden="hidden"></th>
                <td th:text="${usuarios.nombre}"></td>
                <td th:text="${usuarios.apellido}"></td>
                <td th:text="${usuarios.direccion}"></td>
                <td th:text="${usuarios.telefono}"></td>
                <td th:text="${usuarios.correo}"></td>
                <td th:text="${usuarios.alta == true ? 'ALTA':'BAJA'}"></td>
                <td th:text="${usuarios.rol}"></td>

                <td>
                    <div><a th:href="@{/usuario/actualizar/__${usuarios.id}__}">Editar</a></div>
                </td>
                <td>
                    <div><a th:href="@{/usuario/eliminar/__${usuarios.id}__}">Eliminar</a></div>
                </td>


            </tr>

            </tbody>
        </table>
        
        <script>
            import { usuarios } from "./db.js";

            const users = document.querySelector("#users");
            const entrada = document.querySelector("#entrada");
            const alerta = document.querySelector("#alerta");

            (() => {
                document.addEventListener('DOMContentLoaded', filtrarDatos);
                entrada.addEventListener("input", filtrarDatos);
            })()


            function mostrarDatos() {
                usuarios.forEach(item => {
                const { id, nombre, correo } = item;
                const row = document.createElement('tr');
                row.innerHTML = `
                   <td>${id}</td>
                   <td>${nombre}</td>
                   <td>${correo}</td>
                    `
                    users.appendChild(row)
            });
            }

            function filtrarDatos(e) {

            limpiarDatos();

            let entradaInput = (e.target.value)?.toLowerCase() || '';
            const usersFiltrados = usuarios.filter((item) => {
            return item.nombre.toLowerCase().includes(entradaInput);
            })
                usersFiltrados.forEach(item => {
                    const { id, nombre, correo } = item;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td>${id}</td>
                    <td>${nombre}</td>
                    <td>${correo}</td>
                `
                users.appendChild(row)
            });

            if (!users.firstChild) {
                const mensaje = document.createElement("h4");
                mensaje.textContent = "NO HAY USUARIOS CON ESOS FILTROS"
                mensaje.classList.add("text-center", "text-danger", "m-0", "border", "border-danger");
            if (!alerta.firstChild) {
                alerta.appendChild(mensaje)
                }
                } else {
                alerta.innerHTML = ''
                }

                }

            function limpiarDatos() {
                while (users.firstChild) {
                    users.removeChild(users.firstChild);
                }
                }
        
        </script>
            
    </div>
    <span>
         <button class="button2" onclick='goBack()'>Atrás</button>
            <script>
                function goBack() {
                    history.back();
                }
            </script>
    </span>
    
 </article>
        <footer th:replace="frangments/footer:: footer"></footer>
<script src="/script.js"></script>
</body>
</html>
